import{r as g,br as N,bw as O,bo as s,bm as G,bS as Q,bT as W}from"./vendor-BO8aFb6R.js";import{a as F,u as J}from"./vendor_tanstack-Croh7sPd.js";import{c as A,u as B,f as h,h as P,s as X,d as Y,e as Z}from"./index-ousJY6BN.js";import{l as d,B as f,m as K,I as ee,g as x,a as H,i as q,n as k,C as j,f as D,k as se,T as te,h as ae}from"./vendor_antd-DBq17MzT.js";import{u as E}from"./useApiMutation-UX_6QUDT.js";const R=e=>{if(!e?.trim())throw new Error("Hostname не вказано")},ne=async e=>(R(e),A("post","/scripts/execute/updatePolicies.ps1",{hostname:e})),re=async e=>{if(!e)throw new Error("Hostname не вказано");return A("post","/scripts/execute/restartPrintSpooler.ps1",{hostname:e})},oe=async()=>A("get","/scripts/list"),U=async(e,t,r={})=>(R(e),A("post",`/scripts/execute/${t}`,{hostname:e,...r})),ie=({computer:e,lastCheckDate:t,lastCheckColor:r})=>{const{t:a}=N(),_=O(),[m,n]=g.useState(e?.local_notes||""),[c,u]=g.useState(!1),{timezone:i}=B();if(!e)return s.jsx("div",{children:a("no_computer_data","Дані про комп'ютер недоступні")});const v=()=>{n(e.local_notes||""),u(!0)},b=async()=>{try{await A("put",`/computers/${e.id}/local_notes`,{local_notes:m}),x.success({message:a("notes_saved","Локальні примітки збережено")}),u(!1)}catch(y){const L=P(y,a,a("error_saving_notes","Помилка збереження приміток"));y.response?.status===401?(x.error({message:a("session_expired","Ваша сесія закінчилася. Будь ласка, увійдіть знову.")}),_("/login")):x.error({message:L.message})}};return s.jsxs(s.Fragment,{children:[!e.enabled&&e.when_changed&&s.jsxs("div",{style:{color:"#faad14",marginBottom:16,fontWeight:"bold"},children:[a("disabled_in_ad","Відключено в AD з")," ",h(e.when_changed,i)]}),s.jsxs(d,{title:a("specifications","Характеристики"),bordered:!0,column:2,size:"small",style:{marginBottom:24},children:[s.jsx(d.Item,{label:a("ip_address","IP"),children:e.ip_addresses&&e.ip_addresses.length>0?e.ip_addresses[0].address:"-"}),s.jsx(d.Item,{label:a("os_name","Назва ОС"),children:e.os?.name??"-"}),s.jsx(d.Item,{label:a("os_version","Версія ОС"),children:e.os?.version??"-"}),s.jsx(d.Item,{label:a("processor","Процесор"),children:e.processors&&e.processors.length>0?e.processors[0].Name:"-"}),s.jsxs(d.Item,{label:a("ram","RAM"),children:[e.ram??"-"," ",a("mb","МБ")]}),s.jsx(d.Item,{label:a("mac_address","MAC"),children:e.mac_addresses&&e.mac_addresses.length>0?e.mac_addresses[0].address:"-"}),s.jsx(d.Item,{label:a("motherboard","Материнська плата"),children:e.motherboard??"-"}),s.jsx(d.Item,{label:a("last_boot","Перезавантажений"),children:h(e.last_boot,i)}),s.jsx(d.Item,{label:a("last_ad_login","Останній вхід в AD"),children:h(e.last_logon,i)}),s.jsx(d.Item,{label:a("last_check","Остання перевірка"),children:t?s.jsx("span",{style:{color:r},children:h(t,i)}):"-"}),s.jsx(d.Item,{label:a("ad_created","Дата створення в AD"),children:h(e.when_created,i)}),s.jsx(d.Item,{label:a("ad_changed","Дата зміни в AD"),children:h(e.when_changed,i)}),e.check_status==="is_deleted"&&s.jsx(d.Item,{label:a("deleted_from_ad","Видалено з AD"),span:2,style:{color:"#ff4d4f",fontWeight:"bold"},children:a("yes","Так")}),e.ad_notes&&s.jsx(d.Item,{label:a("ad_notes","Примітки AD"),children:e.ad_notes}),s.jsx(d.Item,{label:a("local_notes","Локальні примітки"),span:2,children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.local_notes??"-",s.jsx(f,{icon:s.jsx(G,{}),onClick:v,style:{marginLeft:8}})]})})]}),s.jsx(K,{title:a("edit_local_notes",{hostname:e.hostname}),open:c,onOk:b,onCancel:()=>u(!1),okText:a("save","Зберегти"),cancelText:a("cancel","Скасувати"),children:s.jsx(ee.TextArea,{value:m,onChange:y=>n(y.target.value),rows:4,placeholder:a("enter_local_notes","Введіть локальні примітки")})})]})},le=g.memo(ie),de=({hostname:e})=>{const{t}=N(),[r,a]=g.useState(null),[_,m]=g.useState(!1),[n,c]=g.useState(null),{data:u=[],isLoading:i}=F({queryKey:["scripts"],queryFn:oe}),{mutate:v,isPending:b}=E({mutationFn:()=>X(e),successMessage:t("scan_started"),invalidateQueryKeys:[["computers"],["tasks"]],useNotification:!0,onSuccessCallback:l=>{x.success({message:t("scan_started"),description:t("scan_task_id",{task_id:l.task_id})})}}),{mutate:y,isPending:L}=E({mutationFn:()=>ne(e),successMessage:t("update_policies"),useNotification:!0,onSuccessCallback:l=>{x.success({message:t("update_policies"),description:l.output||t("operation_successful")})}}),{mutate:T,isPending:$}=E({mutationFn:()=>re(e),successMessage:t("restart_print"),useNotification:!0,onSuccessCallback:l=>{x.success({message:t("restart_print"),description:l.output||t("operation_successful")})}}),{mutate:I,isPending:S}=E({mutationFn:l=>U(e,l),successMessage:t("script_execution"),useNotification:!0,onSuccessCallback:l=>{c(l),m(!0),x.success({message:t("script_execution"),description:t("script_executed",{script:r})})}}),z=l=>{a(l)},M=()=>{m(!1),c(null)};return s.jsxs(H,{wrap:!0,children:[s.jsx(f,{type:"primary",onClick:()=>v(),loading:b,children:t("scan_host","Scan host")}),s.jsx(f,{onClick:()=>y(),loading:L,children:t("update_policies","Update policies")}),s.jsx(f,{onClick:()=>T(),loading:$,children:t("restart_print","Restart print")}),s.jsx(q,{style:{width:200},placeholder:t("select_script","Select script"),onChange:z,loading:i,disabled:i||u.length===0,children:u.map(l=>s.jsx(q.Option,{value:l,children:l},l))}),s.jsx(f,{onClick:()=>r&&I(r),disabled:!r||S,loading:S,children:t("execute_script","Execute script")}),s.jsx(K,{title:t("script_execution_result",{script:r}),open:_,onCancel:M,footer:[s.jsx(f,{onClick:M,children:t("close","Close")},"close")],width:800,children:s.jsxs("pre",{style:{maxHeight:"400px",overflow:"auto"},children:[n?.output&&s.jsxs("div",{children:[s.jsxs("strong",{children:[t("output","Output"),":"]}),s.jsx("br",{}),n.output]}),n?.error&&s.jsxs("div",{style:{color:"red",marginTop:"16px"},children:[s.jsxs("strong",{children:[t("error","Error"),":"]}),s.jsx("br",{}),n.error]})]})})]})},ce=({computer:e})=>{const{t}=N(),r=n=>n.sort((c,u)=>!c.removed_on&&u.removed_on?-1:c.removed_on&&!u.removed_on?1:c.removed_on&&u.removed_on?(u.removed_on||"").localeCompare(c.removed_on||""):0),a=[{title:t("model","Модель"),dataIndex:"model",key:"model"},{title:t("serial_number","Серийный номер"),dataIndex:"serial",key:"serial"},{title:t("interface","Интерфейс"),dataIndex:"interface",key:"interface"},{title:t("status","Статус"),dataIndex:"removed_on",key:"status",render:n=>n?s.jsxs(k,{color:"red",children:[t("deleted","Видалено")," (",new Date(n).toLocaleDateString(),")"]}):s.jsx(k,{color:"green",children:t("active","Активно")})}],_=[{title:t("id","ID"),dataIndex:"device_id",key:"device_id"},{title:t("volume_label","Метка"),dataIndex:"volume_label",key:"volume_label"},{title:t("total_space","Объем"),dataIndex:"total_space",key:"total_space",render:n=>`${(n/1024**3).toFixed(2)} ${t("gb","ГБ")}`},{title:t("free_space","Свободно"),dataIndex:"free_space",key:"free_space",render:(n,c)=>`${(n/1024**3).toFixed(2)} ${t("gb","ГБ")} (${c.total_space?(n*100/c.total_space).toFixed(1):0}%)`},{title:t("status","Статус"),dataIndex:"removed_on",key:"status",render:n=>n?s.jsxs(k,{color:"red",children:[t("deleted","Видалено")," (",new Date(n).toLocaleDateString(),")"]}):s.jsx(k,{color:"green",children:t("active","Активно")})}],m=[{title:t("name","Название"),dataIndex:"Name",key:"Name"},{title:t("ram","Обсяг пам'яті"),dataIndex:"AdapterRAM",key:"AdapterRAM",render:n=>n?`${(n/1024**3).toFixed(2)} ${t("gb","ГБ")}`:"-"},{title:t("status","Статус"),dataIndex:"removed_on",key:"status",render:n=>n?s.jsxs(k,{color:"red",children:[t("deleted","Видалено")," (",new Date(n).toLocaleDateString(),")"]}):s.jsx(k,{color:"green",children:t("active","Активно")})}];return s.jsxs(H,{direction:"vertical",size:"large",style:{width:"100%"},children:[!e.is_virtual&&s.jsx(j,{title:t("physical_disks","Физические диски"),children:s.jsx(D,{dataSource:r(e.physical_disks??[]),columns:a,rowKey:"serial",pagination:e.physical_disks&&e.physical_disks.length>5?{pageSize:5}:!1,size:"small"})}),s.jsx(j,{title:t("logical_disks","Логические диски"),children:s.jsx(D,{dataSource:r(e.logical_disks??[]),columns:_,rowKey:"device_id",pagination:e.logical_disks&&e.logical_disks.length>5?{pageSize:5}:!1,size:"small"})}),!e.is_virtual&&s.jsx(j,{title:t("video_cards","Видеокарты"),children:s.jsx(D,{dataSource:r(e.video_cards??[]),columns:m,rowKey:"Name",pagination:e.video_cards&&e.video_cards.length>5?{pageSize:5}:!1,size:"small"})})]})},ue=g.memo(ce),_e="_container_1nv8d_3",pe="_title_1nv8d_11",me="_error_1nv8d_47",C={container:_e,title:pe,error:me},he=()=>{const{t:e}=N();return g.useCallback((r,a)=>{const _=P(r,e,a);return x.error({message:e("error"),description:_.message}),_},[e])},{Title:xe}=te,ke=()=>{const{t:e}=N(),{computerId:t}=Q(),r=Number(t),{isAuthenticated:a,timezone:_}=B(),m=J(),n=he(),[c,u]=g.useState(!1),{data:i,error:v,isLoading:b}=F({queryKey:["computer",r],queryFn:()=>Y(r),enabled:!isNaN(r)&&a}),{data:y=[],error:L,isLoading:T}=F({queryKey:["history",r],queryFn:()=>Z(r),enabled:!isNaN(r)&&a}),$=async(o,p)=>{K.confirm({title:e("confirm_uninstall","Видалити програму {programName}?"),okButtonProps:{loading:c},onOk:async()=>{u(!0);try{const w=await U(o,"uninstall_program.ps1",{ProgramName:p});if(!w.Success)throw new Error(w.Errors?.join(", ")||w.error||"Unknown error");m.invalidateQueries({queryKey:["computer",r]}),x.success({message:e("success"),description:e("program_uninstalled",{programName:p})})}catch(w){n(w,e("failed_to_uninstall",{programName:p}))}finally{u(!1)}}})};if(isNaN(r))return s.jsx("div",{className:C.error,children:e("invalid_computer_id")});if(b)return s.jsx(se,{active:!0});if(v)return s.jsxs("div",{className:C.error,children:[e("error"),": ",P(v).message]});if(!i)return s.jsx("div",{className:C.error,children:e("computer_not_found")});const I=i.last_updated?new Date(i.last_updated):null,S=I?W(new Date,I):1/0,z=S<=7?"#52c41a":S<=30?"#faad14":"#ff4d4f",M=[{title:e("name"),dataIndex:"name",key:"name",sorter:(o,p)=>o.name.localeCompare(p.name)},{title:e("version"),dataIndex:"DisplayVersion",key:"DisplayVersion"},{title:e("install_date"),dataIndex:"InstallDate",key:"InstallDate",render:o=>h(o,_,"dd.MM.yyyy"),sorter:(o,p)=>new Date(o.install_date||0).getTime()-new Date(p.install_date||0).getTime()},{title:e("actions"),key:"actions",render:(o,p)=>s.jsx(f,{type:"primary",danger:!0,onClick:()=>$(i.hostname,p.name),children:e("delete")})}],l=[{title:e("component_type"),dataIndex:"component_type",key:"component_type"},{title:e("details"),key:"details",render:(o,p)=>JSON.stringify(p.data)},{title:e("detected_on"),dataIndex:"detected_on",key:"detected_on",render:o=>h(o,_)},{title:e("removed_on"),dataIndex:"removed_on",key:"removed_on",render:o=>h(o,_)}],V=[{key:"1",label:e("overview"),children:s.jsxs(H,{direction:"vertical",size:"large",style:{width:"100%"},children:[s.jsx(j,{children:s.jsx(le,{computer:i,lastCheckDate:I,lastCheckColor:z})}),s.jsx(j,{title:e("actions"),children:s.jsx(de,{hostname:i.hostname})})]})},{key:"2",label:e("hardware"),children:s.jsx(ue,{computer:i})},{key:"3",label:e("software"),children:s.jsx(j,{children:s.jsx(D,{dataSource:i.software,columns:M,rowKey:o=>`${o.name}-${o.version}`,pagination:{pageSize:15},locale:{emptyText:e("no_data")}})})},{key:"4",label:e("history"),children:s.jsx(j,{children:s.jsx(D,{dataSource:y,columns:l,rowKey:o=>`${o.component_type}-${o.detected_on||""}-${o.removed_on||""}`,loading:T,pagination:{pageSize:15},locale:{emptyText:e("no_data")}})})}];return s.jsxs("div",{className:C.container,children:[s.jsx(xe,{level:2,className:C.title,children:i.hostname}),s.jsx(ae,{defaultActiveKey:"1",items:V})]})};export{ke as default};
